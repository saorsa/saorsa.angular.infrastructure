Saorsa={},"undefined"!=typeof angular&&angular.module("saorsa.interceptors",[]),function(){"use strict";angular.module("saorsa.interceptors").config(["$httpProvider",function(a){var b=["$q",function(a){return{request:function(a){return a.url.startsWith("/api/")&&Saorsa.Utils.showLoading(),a},response:function(a){return a.data&&a.data.messages&&Saorsa.Utils.showMessages(a.data),a.config.url.startsWith("/api/")&&(a.data=Saorsa.Utils.TransformReferencePreservedJson(a.data),Saorsa.Utils.hideLoading()),a},requestError:function(a){return Saorsa.Utils.hideLoading(),a},responseError:function(b){return Saorsa.Utils.hideLoading(),404===b.status||500==b.status?a.reject(b):b}}}];a.interceptors.push(b)}])}(),Saorsa.Utils={},Saorsa.Utils.showLoading=function(){$("#Wait").show()},Saorsa.Utils.hideLoading=function(){$("#Wait").hide()},Saorsa.Utils.fieldsToDate=function(a,b){for(var c=0;c<b.length;c++)a[b[c]]&&(a[b[c]]=new Date(a[b[c]]))},Saorsa.Utils.toDate=function(a,b){if("[object Array]"===Object.prototype.toString.call(a))for(var c=0;c<a.length;c++)Saorsa.Utils.fieldsToDate(a[c],b);else Saorsa.Utils.fieldsToDate(a,b)},Saorsa.Utils.showMessages=function(a){a.success===!1?Saorsa.Utils.showErrors(a.messages):Saorsa.Utils.showOkMessages(a.success===!0?a.messages:a)},Saorsa.Utils.showErrors=function(a){Saorsa.Utils.clearAllMessages();var b=Saorsa.Utils.CreateErrorContainer();if(a&&"[object Array]"===Object.prototype.toString.call(a.$values))for(var c=0;c<a.$values.length;c++)b.append('<p class="text-warning">'+a.$values[c]+"</p>");else b.append('<p class="text-warning">'+a+"</p>")},Saorsa.Utils.showOkMessages=function(a){Saorsa.Utils.clearAllMessages();var b=Saorsa.Utils.CreateMessageContainer();if(a&&"[object Array]"===Object.prototype.toString.call(a.$values))for(var c=0;c<a.$values.length;c++)b.append('<p class="text-info">'+a.$values[c]+"</p>");else b.append('<p class="text-info">'+a+"</p>")},Saorsa.Utils.clearAllMessages=function(){$(".saorsa-message").remove()},Saorsa.Utils.CreateErrorContainer=function(){var a=$('<div class="saorsa-message bg-danger"></div>');return $(".body-content").prepend(a),a},Saorsa.Utils.CreateMessageContainer=function(){var a=$('<div class="saorsa-message bg-info"></div>');return $(".body-content").prepend(a),a},Saorsa.Utils.ToLocalDateString=function(a){var b=new Date(a);return new Date(b.getTime()+-6e4*b.getTimezoneOffset())},Saorsa.Utils.ToUTCDateString=function(a){var b=new Date(a);return new Date(b.getTime()+6e4*b.getTimezoneOffset())},Saorsa.Utils.GetReferencesMap=function(a){function b(a,d){if(a&&a.$id){var e=a.$id;Saorsa.Utils.IsDebug&&console.log("Adding "+d+"(id: "+e+") to flat reference list "),c[e]=a}if(Array.isArray(a))for(var f=0,g=a.length;g>f;f++)b(a[f],d?d+"."+f:""+f);else if(null!=a&&"string"!=typeof a)for(var h in a)b(a[h],d?d+"."+h:h)}var c=new Object;return b(a,""),c},Saorsa.Utils.ReplaceReferences=function(a,b,c){function d(a,b,c,e,f){if(e>=f)Saorsa.Utils.IsDebug&&console.log("Maximum reference replacement depth reached");else if(Saorsa.Utils.IsDebug&&console.log("Searching "+b),e++,Array.isArray(a))for(var g=0,h=a.length;h>g;g++)a[g]&&a[g].$ref&&(Saorsa.Utils.IsDebug&&console.log("Replacing in array: "+(b?b+"."+g:""+g)),a[g]=c[a[g].$ref]),d(a[g],b?b+"."+g:""+g,c,e,f);else if(null!=a&&"string"!=typeof a)for(var i in a)a[i]&&a[i].$ref&&(Saorsa.Utils.IsDebug&&console.log("Replacing in object"+(b?b+"."+i:""+i)),a[i]=c[a[i].$ref]),d(a[i],b?b+"."+i:i,c,e,f)}d(a,"",b,0,c)},Saorsa.Utils.TransformReferencePreservedJson=function(a){Saorsa.Utils.IsDebug&&console.log("Getting flat refrence map");var b=Saorsa.Utils.GetReferencesMap(a);return Saorsa.Utils.IsDebug&&console.log("Replacing references 3 levels deep (object.values.sessions)"),Saorsa.Utils.ReplaceReferences(a,b,3),a},Saorsa.Utils.TraverseDocument=function(a,b){var c;if(a instanceof Object)for(c in a)if(a.hasOwnProperty(c)){if("$id"==c&&a[c]==b)return a;var d=Saorsa.Utils.TraverseDocument(a[c],b);if(d)return d}},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return 0==this.indexOf(a)});