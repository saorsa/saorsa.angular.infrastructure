Saorsa={},"undefined"!=typeof angular&&angular.module("saorsa.interceptors",[]),function(){"use strict";angular.module("saorsa.interceptors").config(["$httpProvider",function($httpProvider){var interceptor=["$q",function($q){return{request:function(config){return config.url.startsWith("/api/")&&Saorsa.Utils.showLoading(),config},response:function(response){return response.data&&response.data.messages&&response.data.messages>0||response.modelState?(Saorsa.Utils.showMessages(response.data,Saorsa.Utils.CurrentMessageContainer),Saorsa.Utils.hideLoading(),response):(response.config.url.startsWith("/api/")&&(response.data=Saorsa.Utils.TransformReferencePreservedJson(response.data),Saorsa.Utils.hideLoading()),response)},requestError:function(response){return Saorsa.Utils.hideLoading(),response},responseError:function(response){return response.data&&response.data.modelState&&Saorsa.Utils.showMessages(response.data,Saorsa.Utils.CurrentMessageContainer),Saorsa.Utils.hideLoading(),$q.reject(response)}}}];$httpProvider.interceptors.push(interceptor)}])}(),Saorsa.Utils={},Saorsa.Utils.IsDebug=!1,Saorsa.Utils.MessageType="dialog",Saorsa.Utils.CurrentMessageContainer=null,Saorsa.Utils.showLoading=function(){$("#Wait").show()},Saorsa.Utils.hideLoading=function(){$("#Wait").hide()},Saorsa.Utils.fieldsToDate=function(object,fields){for(var i=0;i<fields.length;i++)object[fields[i]]&&(object[fields[i]]=new Date(object[fields[i]]))},Saorsa.Utils.toDate=function(object,fields){if("[object Array]"===Object.prototype.toString.call(object))for(var i=0;i<object.length;i++)Saorsa.Utils.fieldsToDate(object[i],fields);else Saorsa.Utils.fieldsToDate(object,fields)},Saorsa.Utils.showMessages=function(response,containerElement){return response.modelState?void Saorsa.Utils.showErrors(Saorsa.Utils.parseWebApiMessages(response.modelState),containerElement):void(response.messages&&1===response.messages.length&&""===response.messages[0]||(response.success===!1?Saorsa.Utils.showErrors(response.messages,containerElement):response.success===!0?Saorsa.Utils.showOkMessages(response.messages,containerElement):Saorsa.Utils.showOkMessages(response,containerElement)))},Saorsa.Utils.showErrors=function(messages,containerElement){Saorsa.Utils.clearAllMessages(containerElement);var container=Saorsa.Utils.CreateErrorContainer(containerElement);if(messages&&"[object Array]"===Object.prototype.toString.call(messages.$values))for(var i=0;i<messages.$values.length;i++)container.append('<p class="text-warning">'+messages.$values[i]+"</p>");else container.append('<p class="text-warning">'+messages+"</p>");switch(Saorsa.Utils.MessageType){case"dialog":container.dialog({width:"auto",maxWidth:600,height:"auto",modal:!0,fluid:!0,resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}}})}},Saorsa.Utils.showOkMessages=function(messages,containerElement){Saorsa.Utils.clearAllMessages(containerElement);var container=Saorsa.Utils.CreateMessageContainer(containerElement);if(messages&&"[object Array]"===Object.prototype.toString.call(messages.$values))for(var i=0;i<messages.$values.length;i++)container.append('<p class="text-info">'+messages.$values[i]+"</p>");else container.append('<p class="text-info">'+messages+"</p>");switch(Saorsa.Utils.MessageType){case"dialog":container.dialog({width:"auto",maxWidth:600,height:"auto",modal:!0,fluid:!0,resizable:!1,buttons:{Ok:function(){$(this).dialog("close")}}})}},Saorsa.Utils.clearAllMessages=function(containerElement){containerElement||(containerElement=""),$(containerElement+" .saorsa-message").remove()},Saorsa.Utils.CreateErrorContainer=function(element){element||(element=".body-content");var container=$('<div class="saorsa-message bg-danger"></div>');return $(element).prepend(container),container},Saorsa.Utils.CreateMessageContainer=function(element){element||(element=".body-content");var container=$('<div class="saorsa-message bg-info"></div>');return $(element).prepend(container),container},Saorsa.Utils.ToLocalDateString=function(dateString){var date=new Date(dateString);return new Date(date.getTime()+-6e4*date.getTimezoneOffset())},Saorsa.Utils.ToUTCDateString=function(dateString){var date=new Date(dateString);return new Date(date.getTime()+6e4*date.getTimezoneOffset())},Saorsa.Utils.GetReferencesMap=function(data){function recurse(cur,prop){if(cur&&cur.$id){var id=cur.$id;Saorsa.Utils.UtilsDebug&&console.log("Adding "+prop+"(id: "+id+") to flat reference list "),result[id]=cur}if(Array.isArray(cur))for(var i=0,l=cur.length;l>i;i++)recurse(cur[i],prop?prop+"."+i:""+i);else if(null!=cur&&"string"!=typeof cur)for(var p in cur)recurse(cur[p],prop?prop+"."+p:p)}var result=new Object;return recurse(data,""),result},Saorsa.Utils.ReplaceReferences=function(data,referenceMap,maxDepth){function recurse(cur,prop,references,currentDepth,max){if(currentDepth>=max)Saorsa.Utils.UtilsDebug&&console.log("Maximum reference replacement depth reached");else if(Saorsa.Utils.UtilsDebug&&console.log("Searching "+prop),currentDepth++,Array.isArray(cur))for(var i=0,l=cur.length;l>i;i++)cur[i]&&cur[i].$ref&&(Saorsa.Utils.UtilsDebug&&console.log("Replacing in array: "+(prop?prop+"."+i:""+i)),cur[i]=references[cur[i].$ref]),recurse(cur[i],prop?prop+"."+i:""+i,references,currentDepth,max);else if(null!=cur&&"string"!=typeof cur)for(var p in cur)cur[p]&&cur[p].$ref&&(Saorsa.Utils.UtilsDebug&&console.log("Replacing in object"+(prop?prop+"."+p:""+p)),cur[p]=references[cur[p].$ref]),recurse(cur[p],prop?prop+"."+p:p,references,currentDepth,max)}recurse(data,"",referenceMap,0,maxDepth)},Saorsa.Utils.TransformReferencePreservedJson=function(data){Saorsa.Utils.UtilsDebug&&console.log("Getting flat refrence map");var referencesMap=Saorsa.Utils.GetReferencesMap(data);return Saorsa.Utils.UtilsDebug&&console.log("Replacing references 3 levels deep (object.values.sessions)"),Saorsa.Utils.ReplaceReferences(data,referencesMap,3),data},Saorsa.Utils.TraverseDocument=function(document,id){var k;if(document instanceof Object)for(k in document)if(document.hasOwnProperty(k)){if("$id"==k&&document[k]==id)return document;var returnObject=Saorsa.Utils.TraverseDocument(document[k],id);if(returnObject)return returnObject}},Saorsa.Utils.Guid=function(){function s4(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return s4()+s4()+"-"+s4()+"-"+s4()+"-"+s4()+"-"+s4()+s4()+s4()},Saorsa.Utils.getGenderFromPid=function(pid){if(10!=pid.length)throw new Error("The PID should be 10 characters at length");return parseInt(pid[8])%2==0?0:1},Saorsa.Utils.determineNewbornFromPid=function(pid){if(!pid||pid.length<2)return!1;var today=new Date,currentYear=today.getFullYear()%100;return currentYear-parseInt(pid[0]+pid[1])==0},Saorsa.Utils.parseWebApiMessages=function(modelState){var message='<ul class="errorsList">';for(var p in modelState)if(p&&"$id"!==p)for(var length=modelState[p].length,i=0;length>i;i++)message+="<li>"+modelState[p][i]+"</li>";return message+"</ul>"},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(str){return 0==this.indexOf(str)}),String.prototype.endsWith=function(suffix){return-1!==this.indexOf(suffix,this.length-suffix.length)};